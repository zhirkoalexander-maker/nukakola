<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Base Defense - Play Online</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            font-family: Arial, sans-serif;
            color: #e0e0e0;
            overflow: hidden;
        }
        
        .wrapper {
            width: 100%;
            max-width: 1600px;
            padding: 10px;
        }
        
        .game-container {
            background: rgba(15, 52, 96, 0.95);
            border: 3px solid #64dd17;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 0 30px rgba(100, 221, 23, 0.5);
        }
        
        .header {
            text-align: center;
            margin-bottom: 15px;
            color: #64dd17;
        }
        
        .header h1 {
            font-size: 2em;
            text-shadow: 0 0 10px #64dd17;
        }
        
        .game-layout {
            display: grid;
            grid-template-columns: 1fr 280px;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        canvas {
            background: #000;
            border: 2px solid #64dd17;
            display: block;
            width: 100%;
            aspect-ratio: 16 / 9;
            max-height: 70vh;
        }
        
        .sidebar {
            background: rgba(0, 0, 0, 0.5);
            border: 2px solid #533483;
            border-radius: 5px;
            padding: 12px;
            color: #b0e0e6;
            font-size: 0.85em;
            overflow-y: auto;
            max-height: 70vh;
        }
        
        .sidebar h3 {
            color: #64dd17;
            font-size: 0.95em;
            margin: 10px 0 8px 0;
            border-bottom: 1px solid #533483;
            padding-bottom: 5px;
        }
        
        .stat-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 4px;
            padding: 2px 0;
        }
        
        .stat-label { color: #76ff03; }
        .stat-value { color: #64dd17; font-weight: bold; }
        
        .block-buttons, .mode-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4px;
            margin-bottom: 8px;
        }
        
        .btn {
            background: #333;
            border: 1px solid #555;
            color: #b0e0e6;
            padding: 4px 6px;
            cursor: pointer;
            border-radius: 3px;
            font-size: 0.75em;
            transition: all 0.2s;
        }
        
        .btn:hover, .btn.active {
            background: #64dd17;
            color: #000;
            font-weight: bold;
        }
        
        .controls {
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid #533483;
            border-radius: 5px;
            padding: 12px;
            color: #b0e0e6;
            font-size: 0.8em;
            line-height: 1.4;
        }
        
        .controls h3 {
            color: #64dd17;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .footer {
            text-align: center;
            color: #b0e0e6;
            font-size: 0.75em;
            margin-top: 10px;
        }
        
        .footer a {
            color: #64dd17;
            text-decoration: none;
        }
        
        .footer a:hover {
            text-decoration: underline;
        }
        
        .fps {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 8px 12px;
            border-radius: 5px;
            font-family: monospace;
            border: 1px solid #00ff00;
            font-size: 0.85em;
        }
        
        .test-banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(90deg, #ff6b00 0%, #ff9500 50%, #ff6b00 100%);
            color: #fff;
            padding: 14px;
            text-align: center;
            font-weight: bold;
            font-size: 15px;
            box-shadow: 0 4px 15px rgba(255, 107, 0, 0.7);
            z-index: 9999;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 4px 15px rgba(255, 107, 0, 0.7); }
            50% { box-shadow: 0 4px 25px rgba(255, 107, 0, 1); }
        }
        
        body {
            padding-top: 45px;
        }
        
        @media (max-width: 1024px) {
            .game-layout {
                grid-template-columns: 1fr;
            }
            .sidebar {
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="test-banner">
        ‚ö†Ô∏è TEST VERSION v2 - FULL GAME ON <a href="https://github.com/zhirkoalexander-maker/nukakola" style="color: #fff; text-decoration: underline;">GITHUB ‚ÜóÔ∏è</a> - Features: Hire Units ($100) ‚Ä¢ Enemy AI ‚Ä¢ Block Building ‚Ä¢ Wave Scaling
    </div>
    <div class="wrapper">
        <div class="game-container">
            <div class="header">
                <h1>‚öîÔ∏è BASE DEFENSE - Play Now</h1>
            </div>
            
            <div class="game-layout">
                <canvas id="gameCanvas" width="1280" height="720"></canvas>
                
                <div class="sidebar">
                    <!-- Stats -->
                    <h3>üìä STATS</h3>
                    <div class="stat-item"><span class="stat-label">Wave</span><span class="stat-value" id="wave">1</span></div>
                    <div class="stat-item"><span class="stat-label">Enemies</span><span class="stat-value" id="enemies">0</span></div>
                    <div class="stat-item"><span class="stat-label">Health</span><span class="stat-value" id="health">100</span></div>
                    <div class="stat-item"><span class="stat-label">Base</span><span class="stat-value" id="basehealth">200</span></div>
                    <div class="stat-item"><span class="stat-label">Money</span><span class="stat-value" id="money">$500</span></div>
                    <div class="stat-item"><span class="stat-label">Score</span><span class="stat-value" id="score">0</span></div>
                    
                    <!-- Blocks -->
                    <h3>üèóÔ∏è BLOCKS</h3>
                    <div class="block-buttons">
                        <button class="btn active" data-block="wood">Wood $40</button>
                        <button class="btn" data-block="stone">Stone $80</button>
                        <button class="btn" data-block="brick">Brick $70</button>
                        <button class="btn" data-block="iron">Iron $150</button>
                        <button class="btn" data-block="diamond">Diamond $400</button>
                    </div>
                    
                    <!-- Mode -->
                    <h3>üéÆ MODE</h3>
                    <div class="mode-buttons">
                        <button class="btn" data-mode="build">BUILD</button>
                        <button class="btn" data-mode="break">BREAK</button>
                        <button class="btn active" data-mode="weapon">WEAPON</button>
                    </div>
                    
                    <!-- Hire NPC -->
                    <h3>üéñÔ∏è HIRE UNITS</h3>
                    <div class="block-buttons">
                        <button class="btn" id="hireBtn" style="grid-column: 1/-1; background: #0066ff; border: 2px solid #00ff00;">üíÇ $100</button>
                    </div>
                    
                    <!-- Controls -->
                    <h3>‚å®Ô∏è CONTROLS</h3>
                    <div class="controls">
                        <strong>Move:</strong> WASD<br>
                        <strong>Mode:</strong> 1/2/3<br>
                        <strong>Weapon:</strong> X-L<br>
                        <strong>Click:</strong> Place/Break<br>
                        <strong>P:</strong> Pause<br>
                        <strong>ESC:</strong> Menu
                    </div>
                </div>
            </div>
            
            <div class="footer">
                <p>‚ö†Ô∏è <strong>TEST VERSION</strong> - Full game with more features on <a href="https://github.com/zhirkoalexander-maker/nukakola">GitHub</a> | <a href="https://github.com/zhirkoalexander-maker/nukakola/blob/main/building_game.py">View Source Code</a></p>
                <p>üíæ Click canvas to focus | üéÆ Use sidebar for controls</p>
            </div>
        </div>
    </div>
    
    <div class="fps" id="fps">FPS: 60</div>
    
    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const WIDTH = canvas.width;
        const HEIGHT = canvas.height;
        
        // Game state
        let gameState = 'menu';
        let playerX = WIDTH / 2;
        let playerY = HEIGHT / 2;
        let playerHealth = 100;
        let baseCoreHealth = 200;
        let money = 500;
        let score = 0;
        let wave = 1;
        let enemies = [];
        let blocks = [];
        let projectiles = [];
        let activeMode = 'weapon';
        let selectedBlock = 'wood';
        let lastWaveSpawn = 0;
        let isPaused = false;
        let npcs = [];
        let npcCost = 100;
        
        const BLOCKS = {
            wood: { color: '#8B5A2B', cost: 40, health: 40 },
            stone: { color: '#A9A9A9', cost: 80, health: 80 },
            brick: { color: '#CD6F2F', cost: 70, health: 60 },
            iron: { color: '#646464', cost: 150, health: 150 },
            diamond: { color: '#96DCFF', cost: 400, health: 300 }
        };
        
        class Enemy {
            constructor(x, y, type = 'zombie') {
                this.x = x;
                this.y = y;
                this.type = type;
                this.speed = 1.5 + (wave * 0.15);
                this.maxHealth = 30 + (wave * 8);
                this.health = this.maxHealth;
                this.damage = 10 + (wave * 3);
                this.size = 15 + Math.floor(wave * 0.5);
                this.experience = 15 + (wave * 8);
                this.shootCooldown = 0;
            }
            
            update() {
                const dx = playerX - this.x;
                const dy = playerY - this.y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist > 0) {
                    this.x += (dx / dist) * this.speed;
                    this.y += (dy / dist) * this.speed;
                }
                
                this.shootCooldown--;
                
                // –í—Ä–∞–≥–∏ —Å—Ç—Ä–µ–ª—è—é—Ç –ø–æ –≤—Ä–∞–≥–∞–º
                if (this.shootCooldown <= 0) {
                    enemies.forEach(target => {
                        if (target !== this) {
                            const tdx = target.x - this.x;
                            const tdy = target.y - this.y;
                            const tdist = Math.sqrt(tdx * tdx + tdy * tdy);
                            if (tdist < 150 && tdist > 0) {
                                projectiles.push(new Projectile(this.x, this.y, target.x, target.y, 15));
                            }
                        }
                    });
                    this.shootCooldown = 30 + Math.random() * 30;
                }
            }
            
            draw() {
                ctx.fillStyle = '#ff6b6b';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                
                ctx.strokeStyle = '#ff0000';
                ctx.lineWidth = 2;
                ctx.stroke();
                
                // Health bar
                const barWidth = this.size * 2;
                ctx.fillStyle = '#ff0000';
                ctx.fillRect(this.x - this.size, this.y - this.size - 8, barWidth, 3);
                ctx.fillStyle = '#00ff00';
                ctx.fillRect(this.x - this.size, this.y - this.size - 8, barWidth * (this.health / this.maxHealth), 3);
            }
        }
        
        class Block {
            constructor(x, y, type = 'wood') {
                this.x = x;
                this.y = y;
                this.type = type;
                this.size = 40;
                this.maxHealth = BLOCKS[type].health;
                this.health = BLOCKS[type].health;
            }
            
            draw() {
                ctx.fillStyle = BLOCKS[this.type].color;
                ctx.fillRect(this.x, this.y, this.size, this.size);
                
                ctx.strokeStyle = '#000';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x, this.y, this.size, this.size);
                
                if (this.health < this.maxHealth) {
                    ctx.fillStyle = '#ff0000';
                    ctx.fillRect(this.x, this.y - 5, this.size, 3);
                    ctx.fillStyle = '#00ff00';
                    ctx.fillRect(this.x, this.y - 5, (this.size) * (this.health / this.maxHealth), 3);
                }
            }
            
            collides(x, y) {
                return x >= this.x && x < this.x + this.size && 
                       y >= this.y && y < this.y + this.size;
            }
        }
        
        class Projectile {
            constructor(x, y, targetX, targetY, damage = 25) {
                this.x = x;
                this.y = y;
                this.targetX = targetX;
                this.targetY = targetY;
                this.damage = damage;
                this.speed = 8;
                this.size = 5;
                const dx = targetX - x;
                const dy = targetY - y;
                const dist = Math.sqrt(dx * dx + dy * dy);
                this.vx = (dx / dist) * this.speed;
                this.vy = (dy / dist) * this.speed;
                this.life = 200;
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.life--;
            }
            
            draw() {
                ctx.fillStyle = '#ffff00';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
                ctx.shadowColor = '#ffff00';
                ctx.shadowBlur = 8;
                ctx.strokeStyle = '#ffaa00';
                ctx.lineWidth = 1;
                ctx.stroke();
                ctx.shadowBlur = 0;
            }
        }
        
        class NPC {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.vx = (Math.random() - 0.5) * 2;
                this.vy = (Math.random() - 0.5) * 2;
                this.size = 12;
                this.health = 50;
                this.maxHealth = 50;
                this.shootCooldown = 0;
                this.lifetime = 300; // 5 seconds at 60fps
            }
            
            update() {
                this.x += this.vx;
                this.y += this.vy;
                this.lifetime--;
                this.shootCooldown--;
                
                // Bounce off walls
                if (this.x < 20 || this.x > WIDTH - 20) this.vx *= -1;
                if (this.y < 20 || this.y > HEIGHT - 20) this.vy *= -1;
                
                // Find and attack enemies
                if (this.shootCooldown <= 0) {
                    let closestEnemy = null;
                    let closestDist = 150;
                    
                    enemies.forEach(enemy => {
                        const dx = enemy.x - this.x;
                        const dy = enemy.y - this.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        if (dist < closestDist) {
                            closestDist = dist;
                            closestEnemy = enemy;
                        }
                    });
                    
                    if (closestEnemy) {
                        projectiles.push(new Projectile(this.x, this.y, closestEnemy.x, closestEnemy.y, 20));
                        this.shootCooldown = 20;
                    }
                }
            }
            
            draw() {
                ctx.fillStyle = '#00ccff';
                ctx.fillRect(this.x - this.size, this.y - this.size, this.size * 2, this.size * 2);
                ctx.strokeStyle = '#0099ff';
                ctx.lineWidth = 2;
                ctx.strokeRect(this.x - this.size, this.y - this.size, this.size * 2, this.size * 2);
                
                // Lifetime indicator
                if (this.lifetime < 60) {
                    ctx.fillStyle = 'rgba(255, 0, 0, 0.5)';
                    ctx.fillRect(this.x - this.size, this.y - this.size - 8, (this.size * 2) * (this.lifetime / 60), 3);
                }
            }
        }
        
        function drawMenu() {
            const grad = ctx.createLinearGradient(0, 0, 0, HEIGHT);
            grad.addColorStop(0, '#1a3a52');
            grad.addColorStop(1, '#0f1f2e');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            
            ctx.fillStyle = '#FFD700';
            ctx.font = 'bold 90px Arial';
            ctx.textAlign = 'center';
            ctx.shadowColor = '#FF6B00';
            ctx.shadowBlur = 20;
            ctx.fillText('‚öîÔ∏è DEFENSE', WIDTH / 2, 120);
            ctx.shadowBlur = 0;
            
            ctx.fillStyle = '#b0e0e6';
            ctx.font = '28px Arial';
            ctx.fillText('üéÆ Tower Defense Game', WIDTH / 2, 180);
            
            ctx.fillStyle = '#64dd17';
            ctx.fillRect(WIDTH / 2 - 180, HEIGHT / 2, 360, 80);
            ctx.fillStyle = '#000';
            ctx.font = 'bold 36px Arial';
            ctx.fillText('‚ñ∂Ô∏è CLICK TO START', WIDTH / 2, HEIGHT / 2 + 55);
            
            ctx.fillStyle = '#FF6B00';
            ctx.font = 'bold 20px Arial';
            ctx.fillText('TEST VERSION v2 - Hire Units ‚Ä¢ Build Blocks ‚Ä¢ Survive Waves', WIDTH / 2, HEIGHT - 80);
            
            ctx.fillStyle = '#b0e0e6';
            ctx.font = '16px Arial';
            ctx.fillText('Full game available on GitHub - Download for desktop experience', WIDTH / 2, HEIGHT - 40);
        }
        
        function drawGame() {
            const grad = ctx.createLinearGradient(0, 0, 0, HEIGHT);
            grad.addColorStop(0, '#1a2a3e');
            grad.addColorStop(1, '#0f1520');
            ctx.fillStyle = grad;
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            
            blocks.forEach(block => block.draw());
            enemies.forEach(enemy => enemy.draw());
            npcs.forEach(npc => npc.draw());
            projectiles.forEach(proj => proj.draw());
            
            // Base core - bigger and better
            ctx.fillStyle = '#FFD700';
            ctx.beginPath();
            ctx.arc(playerX, playerY, 22, 0, Math.PI * 2);
            ctx.fill();
            
            // Glow effect
            ctx.shadowColor = 'rgba(255, 215, 0, 0.8)';
            ctx.shadowBlur = 15;
            ctx.strokeStyle = 'rgba(255, 165, 0, 0.5)';
            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.arc(playerX, playerY, 26, 0, Math.PI * 2);
            ctx.stroke();
            ctx.shadowBlur = 0;
            
            ctx.strokeStyle = '#FFA500';
            ctx.lineWidth = 3;
            ctx.beginPath();
            ctx.arc(playerX, playerY, 22, 0, Math.PI * 2);
            ctx.stroke();
            
            // Player
            ctx.fillStyle = '#00ff00';
            ctx.fillRect(playerX - 12, playerY - 12, 24, 24);
            ctx.strokeStyle = '#64dd17';
            ctx.lineWidth = 2;
            ctx.strokeRect(playerX - 12, playerY - 12, 24, 24);
            
            // UI with better layout
            ctx.fillStyle = '#64dd17';
            ctx.font = 'bold 18px Arial';
            ctx.textAlign = 'left';
            ctx.fillText(`WAVE ${wave}`, 15, 35);
            ctx.fillText(`ENEMIES ${enemies.length}`, 15, 60);
            ctx.fillText(`MODE: ${activeMode.toUpperCase()}`, 15, 85);
            
            ctx.textAlign = 'right';
            ctx.fillText(`‚ù§Ô∏è ${Math.max(0, Math.floor(playerHealth))}`, WIDTH - 15, 35);
            ctx.fillText(`üõ°Ô∏è ${Math.max(0, Math.floor(baseCoreHealth))}`, WIDTH - 15, 60);
            ctx.fillText(`SCORE ${score}`, WIDTH - 15, 85);
            
            // Money display - bigger
            ctx.font = 'bold 20px Arial';
            ctx.textAlign = 'center';
            ctx.fillStyle = '#64dd17';
            ctx.fillText(`üí∞ $${money}`, WIDTH / 2, 35);
            ctx.fillText(`UNITS: ${npcs.length}`, WIDTH / 2, 60);
            
            if (isPaused) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, WIDTH, HEIGHT);
                ctx.fillStyle = '#64dd17';
                ctx.font = 'bold 48px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('‚è∏Ô∏è PAUSED', WIDTH / 2, HEIGHT / 2);
                ctx.fillStyle = '#b0e0e6';
                ctx.font = '20px Arial';
                ctx.fillText('Press P to continue', WIDTH / 2, HEIGHT / 2 + 50);
            }
        }
        
        function drawGameOver() {
            ctx.fillStyle = 'rgba(0, 0, 0, 0.8)';
            ctx.fillRect(0, 0, WIDTH, HEIGHT);
            
            ctx.fillStyle = '#FF4444';
            ctx.font = 'bold 64px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('GAME OVER', WIDTH / 2, 150);
            
            ctx.fillStyle = '#b0e0e6';
            ctx.font = '24px Arial';
            ctx.fillText(`Final Score: ${score}`, WIDTH / 2, 220);
            ctx.fillText(`Waves Survived: ${wave - 1}`, WIDTH / 2, 260);
            
            ctx.fillStyle = '#64dd17';
            ctx.fillRect(WIDTH / 2 - 150, 320, 300, 60);
            ctx.fillStyle = '#000';
            ctx.font = 'bold 28px Arial';
            ctx.fillText('CLICK TO RESTART', WIDTH / 2, 360);
        }
        
        function updateGame() {
            if (isPaused) return;
            
            const keys = window.keysPressed || {};
            if (keys['w'] && playerY > 30) playerY -= 3;
            if (keys['s'] && playerY < HEIGHT - 30) playerY += 3;
            if (keys['a'] && playerX > 30) playerX -= 3;
            if (keys['d'] && playerX < WIDTH - 30) playerX += 3;
            
            enemies.forEach(enemy => enemy.update());
            npcs.forEach(npc => npc.update());
            projectiles.forEach(proj => proj.update());
            
            projectiles = projectiles.filter(p => p.life > 0);
            npcs = npcs.filter(npc => npc.lifetime > 0);
            
            projectiles.forEach(proj => {
                enemies = enemies.filter(enemy => {
                    const dx = enemy.x - proj.x;
                    const dy = enemy.y - proj.y;
                    if (Math.sqrt(dx * dx + dy * dy) < 20) {
                        enemy.health -= proj.damage;
                        proj.life = 0;
                        if (enemy.health <= 0) {
                            score += enemy.experience;
                            money += Math.floor(enemy.experience / 10);
                        }
                        return enemy.health > 0;
                    }
                    return true;
                });
            });
            
            enemies = enemies.filter(e => e.health > 0);
            
            enemies.forEach(enemy => {
                const dx = enemy.x - playerX;
                const dy = enemy.y - playerY;
                const dist = Math.sqrt(dx * dx + dy * dy);
                
                if (dist < 40) {
                    playerHealth -= 0.05;
                    baseCoreHealth -= 0.02;
                }
            });
            
            if (baseCoreHealth <= 0) {
                gameState = 'gameover';
            }
            
            if (enemies.length === 0 && Date.now() - lastWaveSpawn > 2000) {
                wave++;
                spawnWave();
            }
        }
        
        function spawnWave() {
            const count = 3 + Math.floor(wave * 2.5);
            for (let i = 0; i < count; i++) {
                const angle = (Math.PI * 2 * i) / count;
                const distance = 400 + wave * 30;
                const x = WIDTH / 2 + Math.cos(angle) * distance;
                const y = HEIGHT / 2 + Math.sin(angle) * (distance * 0.7);
                enemies.push(new Enemy(x, y));
            }
            lastWaveSpawn = Date.now();
        }
        
        function updateUI() {
            document.getElementById('wave').textContent = wave;
            document.getElementById('enemies').textContent = enemies.length;
            document.getElementById('health').textContent = Math.max(0, Math.floor(playerHealth));
            document.getElementById('basehealth').textContent = Math.max(0, Math.floor(baseCoreHealth));
            document.getElementById('money').textContent = '$' + money;
            document.getElementById('score').textContent = score;
        }
        
        function draw() {
            if (gameState === 'menu') drawMenu();
            else if (gameState === 'playing') drawGame();
            else if (gameState === 'gameover') drawGameOver();
        }
        
        // Input
        window.keysPressed = {};
        document.addEventListener('keydown', (e) => {
            window.keysPressed[e.key.toLowerCase()] = true;
            
            if (e.key === '1') activeMode = 'build';
            if (e.key === '2') activeMode = 'break';
            if (e.key === '3') activeMode = 'weapon';
            if (e.key.toLowerCase() === 'p' && gameState === 'playing') isPaused = !isPaused;
            if (e.key === 'Escape') gameState = 'menu';
        });
        
        document.addEventListener('keyup', (e) => {
            window.keysPressed[e.key.toLowerCase()] = false;
        });
        
        // Block selection UI
        document.querySelectorAll('[data-block]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('[data-block]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                selectedBlock = btn.dataset.block;
            });
        });
        
        // Mode selection UI
        document.querySelectorAll('[data-mode]').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('[data-mode]').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                activeMode = btn.dataset.mode;
            });
        });
        
        // Hire NPC
        document.getElementById('hireBtn').addEventListener('click', () => {
            if (gameState === 'playing' && money >= npcCost) {
                money -= npcCost;
                npcs.push(new NPC(playerX + (Math.random() - 0.5) * 60, playerY + (Math.random() - 0.5) * 60));
                npcCost = Math.ceil(npcCost * 1.2);
                document.getElementById('hireBtn').textContent = `üíÇ $${npcCost}`;
                document.getElementById('hireBtn').style.background = '#0066ff';
            }
        });
        
        // Canvas clicks
        canvas.addEventListener('click', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = (e.clientX - rect.left) * (canvas.width / rect.width);
            const y = (e.clientY - rect.top) * (canvas.height / rect.height);
            
            if (gameState === 'menu') {
                if (x > WIDTH / 2 - 150 && x < WIDTH / 2 + 150 && y > HEIGHT / 2 && y < HEIGHT / 2 + 70) {
                    gameState = 'playing';
                    playerHealth = 100;
                    baseCoreHealth = 200;
                    money = 500;
                    score = 0;
                    wave = 1;
                    blocks = [];
                    enemies = [];
                    projectiles = [];
                    npcs = [];
                    npcCost = 100;
                    spawnWave();
                }
            } else if (gameState === 'gameover') {
                if (x > WIDTH / 2 - 150 && x < WIDTH / 2 + 150 && y > 320 && y < 380) {
                    gameState = 'menu';
                }
            } else if (gameState === 'playing' && !isPaused) {
                if (activeMode === 'build' && money >= BLOCKS[selectedBlock].cost) {
                    const gridX = Math.floor(x / 40) * 40;
                    const gridY = Math.floor(y / 40) * 40;
                    let canBuild = true;
                    blocks.forEach(b => {
                        if (b.x === gridX && b.y === gridY) canBuild = false;
                    });
                    if (canBuild) {
                        blocks.push(new Block(gridX, gridY, selectedBlock));
                        money -= BLOCKS[selectedBlock].cost;
                    }
                } else if (activeMode === 'break') {
                    blocks = blocks.filter(block => {
                        if (block.collides(x, y)) {
                            money += Math.floor(BLOCKS[block.type].cost * 0.5);
                            return false;
                        }
                        return true;
                    });
                } else if (activeMode === 'weapon') {
                    enemies.forEach(enemy => {
                        projectiles.push(new Projectile(playerX, playerY, enemy.x, enemy.y, 30));
                    });
                }
            }
        });
        
        // FPS
        let fpsCount = 0, lastFps = Date.now();
        function updateFPS() {
            fpsCount++;
            const now = Date.now();
            if (now - lastFps >= 1000) {
                document.getElementById('fps').textContent = `FPS: ${fpsCount}`;
                fpsCount = 0;
                lastFps = now;
            }
        }
        
        // Main loop
        function gameLoop() {
            updateGame();
            updateUI();
            draw();
            updateFPS();
            requestAnimationFrame(gameLoop);
        }
        
        gameLoop();
    </script>
</body>
</html>
